<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AulIA - Plataforma de Simulaciones</title>
    <style>
        :root {
            --primary: #006A6A;
            --bg-color: #FFFFFF;
            --card-bg: #F8F9FA;
            --text-main: #212529;
            --radius: 12px;
            --font-family: 'Segoe UI', sans-serif;
            --chat-user: #e3f2fd;
            --chat-ai: #f1f8e9;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: var(--font-family); background-color: var(--bg-color); color: var(--text-main); }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        header { padding: 40px 20px; text-align: center; }
        
        .logo-container { margin-bottom: 20px; display: flex; justify-content: center; }
        .logo-img { max-width: 300px; height: auto; }
        .hero-desc { max-width: 700px; margin: 20px auto; font-size: 1.1rem; color: #555; }

        /* Estilos generales Grid y Cards */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px; padding: 20px 0; }
        .sim-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; padding: 20px 0; }

        .card { 
            background: var(--card-bg); 
            padding: 30px; 
            border-radius: var(--radius); 
            border: 1px solid #eee;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 200px; /* Altura m√≠nima para igualar */
        }
        .card:hover { transform: translateY(-5px); border-color: var(--primary); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        
        .card h3 { color: var(--primary); margin-bottom: 10px; font-size: 1.1rem; word-break: break-word; }
        .card p { font-size: 0.95rem; color: #444; margin-bottom: 15px; line-height: 1.4; }

        /* Estilos espec√≠ficos para los Casos */
        .case-container {
            background: #fff;
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            border-left: 5px solid var(--primary);
        }
        .case-text { font-size: 1.05rem; line-height: 1.6; color: #333; }
        .case-text ul { margin-left: 20px; margin-top: 10px; }
        .case-text li { margin-bottom: 5px; }

        /* Estilos de las Tareas y el Chat */
        .task-block { margin-top: 40px; border-top: 1px solid #eee; padding-top: 20px; }
        .task-title { font-weight: bold; color: var(--primary); font-size: 1.1rem; margin-bottom: 10px; }
        .task-desc { margin-bottom: 15px; color: #555; }

        .chat-box {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-top: 15px;
            display: flex; flex-direction: column;
            overflow: hidden;
        }
        .chat-header { 
            background: #f4f4f4; padding: 10px 15px; font-weight: bold; color: var(--primary);
            border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center;
        }
        
        .chat-messages {
            height: 300px; overflow-y: auto; padding: 15px; background: #fafafa;
            display: flex; flex-direction: column; gap: 10px;
        }
        
        .message { padding: 10px 15px; border-radius: 12px; max-width: 85%; font-size: 0.95rem; line-height: 1.4; }
        .msg-user { align-self: flex-end; background-color: var(--chat-user); color: #004d4d; border-bottom-right-radius: 2px; }
        .msg-ai { align-self: flex-start; background-color: var(--chat-ai); color: #2e7d32; border-bottom-left-radius: 2px; border: 1px solid #c8e6c9; }

        .chat-input-area { display: flex; gap: 10px; padding: 10px; background: #fff; border-top: 1px solid #eee; }
        .chat-input { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 6px; }
        .chat-btn { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; }
        .chat-btn:hover { opacity: 0.9; }

        /* Estilos Simulaciones */
        .card-sim { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 20px; text-align: center; color: #555; cursor: default; }
        .card-ia { background: #e6fcfc; border: 2px dashed var(--primary); cursor: pointer; color: var(--primary); font-weight: bold; }
        .card-ia:hover { background: #d0f0f0; }

        .btn { background: var(--primary); color: white; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; width: 100%; margin-top: auto; }
        .hidden { display: none; }
        .breadcrumbs { margin: 20px 0; color: var(--primary); cursor: pointer; font-size: 0.9rem; }
    </style>
</head>
<body>

    <header>
        <div class="container">
            <div class="logo-container">
                <img src="logo.png" alt="Logo AulIA" class="logo-img" onerror="this.style.display='none'; document.getElementById('alt-logo').style.display='block'">
                <h1 id="alt-logo" style="display:none; color:var(--primary); font-size:2.5rem;">AulIA</h1>
            </div>
            <p class="hero-desc">
                Plataforma de simulaciones educativas basada en IA generativa. Practica la toma de decisiones y la reflexi√≥n docente en entornos profesionales seguros.
            </p>
        </div>
    </header>

    <div class="container">
        <div id="breadcrumbs" class="breadcrumbs hidden" onclick="app.goHome()"> Inicio </div>
        
        <section id="view-home"><div class="grid" id="degrees-grid"></div></section>
        
        <section id="view-subjects" class="hidden">
            <h2 id="degree-title" style="margin-bottom:20px; color:var(--primary)"></h2>
            <div class="grid" id="subjects-grid"></div>
        </section>

        <section id="view-levels" class="hidden">
            <h2 id="subject-title" style="margin-bottom:20px; color:var(--primary)"></h2>
            <div class="grid">
                <div class="card"><h3>Nivel 1</h3><button class="btn" onclick="app.loadSimulations(1)">Acceder</button></div>
                <div class="card"><h3>Nivel 2</h3><button class="btn" onclick="app.loadSimulations(2)">Acceder</button></div>
                <div class="card"><h3>Nivel 3</h3><button class="btn" onclick="app.loadSimulations(3)">Acceder</button></div>
            </div>
        </section>

        <section id="view-units" class="hidden">
            <h2 id="unit-subject-title" style="margin-bottom:20px; color:var(--primary)"></h2>
            <p style="margin-bottom:20px;">Selecciona la Unidad Competencial:</p>
            <div class="grid" id="units-grid"></div>
        </section>

        <section id="view-uc3-menu" class="hidden">
            <h2 style="margin-bottom:20px; color:var(--primary)">Unidad Competencial 3</h2>
            <div class="grid">
                <div class="card">
                    <h3>Actividad de la Unidad Competencial 3</h3>
                    <p>Resoluci√≥n de casos pr√°cticos evaluables.</p>
                    <button class="btn" onclick="app.loadUC3ActivityMenu()">Acceder</button>
                </div>
                <div class="card">
                    <h3>Pr√°ctica con simulaciones</h3>
                    <p>Entrenamiento pr√°ctico con diferentes niveles.</p>
                    <button class="btn" onclick="app.loadUC3PracticeLevels()">Acceder</button>
                </div>
            </div>
        </section>

        <section id="view-uc3-cases-menu" class="hidden">
            <h2 style="margin-bottom:20px; color:var(--primary)">Selecci√≥n de Caso de Estudio</h2>
            <div class="grid">
                <div class="card"><h3>Caso de Marina</h3><button class="btn" onclick="app.loadCase('marina')">Acceder</button></div>
                <div class="card"><h3>Caso de Ana√≠s</h3><button class="btn" onclick="app.loadCase('anais')">Acceder</button></div>
                <div class="card"><h3>Caso de Ra√∫l</h3><button class="btn" onclick="app.loadCase('raul')">Acceder</button></div>
                <div class="card"><h3>Caso de √Ångel</h3><button class="btn" onclick="app.loadCase('angel')">Acceder</button></div>
                <div class="card"><h3>Caso de Lu√≠s</h3><button class="btn" onclick="app.loadCase('luis')">Acceder</button></div>
            </div>
        </section>

        <section id="view-uc3-case-detail" class="hidden">
            <h2 id="case-title" style="margin-bottom:20px; color:var(--primary)"></h2>
            
            <div id="case-content" class="case-container"></div>

            <div id="case-tasks-container">
                </div>
        </section>

        <section id="view-uc3-levels" class="hidden">
            <h2 style="margin-bottom:20px; color:var(--primary)">UC3 - Pr√°ctica con simulaciones</h2>
            <div class="grid">
                <div class="card"><h3>Nivel 1 (F√°cil)</h3><p>Casos guiados, menor complejidad.</p><button class="btn" onclick="app.loadUC3SimGrid(1)">Acceder</button></div>
                <div class="card"><h3>Nivel 2 (Intermedio)</h3><p>Casos con m√°s variables y decisiones.</p><button class="btn" onclick="app.loadUC3SimGrid(2)">Acceder</button></div>
                <div class="card"><h3>Nivel 3 (Dif√≠cil)</h3><p>Casos complejos, dilemas.</p><button class="btn" onclick="app.loadUC3SimGrid(3)">Acceder</button></div>
            </div>
        </section>

        <section id="view-uc3-sims" class="hidden">
            <h2 id="uc3-sim-title" style="margin-bottom:20px; color:var(--primary)"></h2>
            <div id="uc3-sim-grid" class="sim-grid"></div>
        </section>

        <section id="view-simulations" class="hidden">
            <h2 id="level-title" style="margin-bottom:20px; color:var(--primary)"></h2>
            <div id="simulations-grid" class="sim-grid"></div>
        </section>
    </div>

    <script>
        // --- CEREBRO DE LA IA (Training Data) ---
        // L√≥gica de validaci√≥n pedag√≥gica basada en los PDFs
        const aiBrain = {
            marina: {
                focus: "disfonia",
                check: (text) => {
                    const t = text.toLowerCase();
                    if(t.includes('cirug√≠a') || t.includes('operar')) return "‚ö†Ô∏è <b>Precauci√≥n:</b> ¬øEs la cirug√≠a la primera opci√≥n en una ni√±a de 5 a√±os con n√≥dulos recientes? Revisa el concepto de higiene vocal.";
                    if(t.includes('higiene vocal') || t.includes('pautas') || t.includes('gritos')) return "‚úÖ Correcto. La intervenci√≥n debe priorizar la eliminaci√≥n del mal uso vocal (gritos, tensi√≥n) y la reeducaci√≥n.";
                    return "Interesante. Aseg√∫rate de diferenciar si el problema es org√°nico puro o funcional (por mal uso). ¬øQu√© pautas dar√≠as a la familia?";
                }
            },
            anais: {
                focus: "dislalia_fonetica",
                check: (text) => {
                    const t = text.toLowerCase();
                    if(t.includes('simplifica') || t.includes('retraso')) return "‚ö†Ô∏è <b>Ojo:</b> Ana√≠s tiene errores fijos y estables (ceceo, rotacismo). No parece un problema de 'organizaci√≥n' (fonol√≥gico), sino de ejecuci√≥n (fon√©tico). ¬øC√≥mo cambia eso tu diagn√≥stico?";
                    if(t.includes('articulaci√≥n') || t.includes('praxias') || t.includes('punto')) return "‚úÖ Bien visto. Al ser un problema fon√©tico (articulatorio), las actividades de praxias y punto de articulaci√≥n son adecuadas.";
                    return "Recuerda revisar si Ana√≠s 'no sabe' pronunciar el sonido (motor/fon√©tico) o 'no sabe' usarlo en la palabra (mental/fonol√≥gico).";
                }
            },
            raul: {
                focus: "fonologico",
                check: (text) => {
                    const t = text.toLowerCase();
                    if(t.includes('dislalia') || t.includes('boca') || t.includes('lengua')) return "‚ö†Ô∏è <b>Revisi√≥n:</b> El texto dice que Ra√∫l *sabe* articular los fonemas aislados. Su problema es al formar palabras (dice 'mil√≥n' por 'lim√≥n'). Eso no es Dislalia, es Trastorno Fonol√≥gico.";
                    if(t.includes('bosch') || t.includes('estructur') || t.includes('discrimin')) return "‚úÖ Exacto. Est√°s identificando procesos de simplificaci√≥n (Laura Bosch). La intervenci√≥n debe ser cognitiva/auditiva, no motora.";
                    return "¬øEs un problema de m√∫sculos o de estructuraci√≥n mental de la palabra?";
                }
            },
            angel: {
                focus: "disglosia",
                check: (text) => {
                    const t = text.toLowerCase();
                    if(t.includes('ense√±ar') && !t.includes('m√©dico')) return "‚ö†Ô∏è Recuerda: hay una causa org√°nica f√≠sica (frenillo corto). Antes de ense√±ar a pronunciar, ¬øqu√© intervenci√≥n externa se necesita?";
                    if(t.includes('frenectom√≠a') || t.includes('cirug√≠a') || t.includes('m√©dic')) return "‚úÖ Correcto. Al ser una Disglosia (org√°nica), se requiere valoraci√≥n m√©dica primero. Luego el logopeda trabaja la rehabilitaci√≥n.";
                    return "Valora la causa anat√≥mica descrita en el caso.";
                }
            },
            luis: {
                focus: "neurologico",
                check: (text) => {
                    const t = text.toLowerCase();
                    if(t.includes('tartamudez') || t.includes('disfemia')) return "‚ö†Ô∏è <b>Cuidado:</b> Parece tartamudez por los bloqueos, pero el caso menciona 'espasticidad' y 'debilidad' corporal. La disfemia no tiene esos signos motores. Podr√≠a ser Disartria.";
                    if(t.includes('neurol√≥g') || t.includes('disartria') || t.includes('motor')) return "‚úÖ Muy bien detectado. Los signos f√≠sicos (espasticidad) apuntan a un origen neurol√≥gico, no es una simple dificultad de fluidez.";
                    return "F√≠jate bien en los s√≠ntomas f√≠sicos que acompa√±an al habla lenta.";
                }
            }
        };

        // CONTENIDO DE LOS CASOS
        const casesData = {
            marina: `
                <strong>Antecedentes:</strong> Marina es una ni√±a de 5 a√±os que tiene una voz ligeramente grave en relaci√≥n con su constituci√≥n y edad, y parece que realiza un gran esfuerzo vocal cuando habla.<br><br>
                <strong>Observaci√≥n:</strong> Le cuesta cantar y tiene dificultades para emitir sonidos agudos. Tiene tambi√©n alteraciones fonatorias como "gallos", y en ocasiones produce sonidos inaudibles y muy forzados. Presenta una musculatura superior con un tono elevado, con rigidez.<br><br>
                <strong>Factores:</strong> En cuanto a los factores predisponentes, es una ni√±a que suele gritar, aunque no presenta afectaciones pulmonares ni un ambiente familiar excitado o excesivamente ruidoso.<br><br>
                <strong>Informe M√©dico:</strong> El informe de la ORL mediante la fibroscopia nasolar√≠ngea expone que se aprecian n√≥dulos vocales.
            `,
            anais: `
                <strong>Antecedentes:</strong> Ana√Øs es una ni√±a de 5 a√±os que presenta un lenguaje que la AL ha descrito como ‚Äúinfantilizado‚Äù.<br><br>
                <strong>Alteraciones observadas:</strong>
                <ul>
                    <li>Seseo (sustituci√≥n de /c/ por /s/, por ejemplo, cigarro por sigarro, zapato por sapato).</li>
                    <li>Rotacismo (sustituci√≥n del fonema /rr/ por /l/ o /r/, por ejemplo, rat√≥n por lat√≥n, perro por, pero).</li>
                    <li>Omisi√≥n del sonido /r/ a final de palabra, por ejemplo, collar por coll√°.</li>
                    <li>Omisi√≥n del fonema /s/ en posici√≥n inversa, por ejemplo, espada por epada, escoba por ecoba, pastel por pat√©.</li>
                    <li>Simplificaci√≥n de sinfones vibrantes y l√≠quidos y/o sustituci√≥n de sinfones vibrantes por l√≠quidos, por ejemplo, globo por lobo, brazo por blazo, grifo por lifo, tren por tlen, pueblo por puebo, compra por copl√°.</li>
                    <li>Reducci√≥n de algunos sinfones a un solo elemento, por ejemplo, peine por pene, autob√∫s por atob√∫s.</li>
                    <li>Coalescencia o asimilaci√≥n de dos sonidos diferentes, por ejemplo, lim√≥n por mim√≥n, luna por nuna, yema por nema.</li>
                    <li>Omisi√≥n de consonantes en posici√≥n inversa.</li>
                </ul>
            `,
            raul: `
                <strong>Situaci√≥n:</strong> Ra√∫l, ¬øCu√°l es su caso? A continuaci√≥n, se especifican las caracter√≠sticas:<br><br>
                <strong>FON√âTICAMENTE:</strong> sabe y puede articular todos los fonemas menos la /r/ que sustituye por la /l/, los grupos voc√°licos como /ei/ ‚Äì /ai/ ‚Äì /au/ ‚Äì /eu/ ‚Äì /oi/ ‚Äì /iu/, los grupos conson√°nticos l√≠quidos y vibrantes /pl/ ‚Äì /pr/ ‚Äì /bl/ ‚Äì /br/ ‚Äì /fl/ ‚Äì /fr/ ‚Äì /kl/ ‚Äì /cr/ ‚Äì /gr/ ‚Äì /tr/ ‚Äì /dr/, y los fonemas /s/ ‚Äì /r/ ‚Äì /l/ en posici√≥n inversa.<br><br>
                <strong>FONOL√ìGICAMENTE y CONCIENCIA FONOL√ìGICA:</strong> encontramos diversos procesos fonol√≥gicos de simplificaci√≥n del habla tales como procesos sustitutivos, procesos asimilatorios y procesos relativos a la estructura de la s√≠laba, seg√∫n Laura Bosch (1983).<br>
                Estos √∫ltimos concretamente son:
                <ul>
                    <li>Omisiones de consonantes finales (/lapiz/ por /lapi/, /vatio/ por /vati/).</li>
                    <li>Omisi√≥n de consonantes iniciales (/nube/ por /ube/).</li>
                    <li>Omisi√≥n de s√≠labas √°tonas iniciales (/escoba/ por /coba/).</li>
                    <li>Met√°tesis o inversi√≥n de una secuencia (/lim√≥n/ por /mil√≥n/, /yema/ por /meya/, /celular/ por /felular/, /llave/ por /valle/).</li>
                    <li>Omisi√≥n del sonido /r/ a final de palabra, por ejemplo /collar/ por /coll√°/.</li>
                </ul>
            `,
            angel: `
                <strong>Relato del alumno:</strong> ‚ÄúHola mi nombrle es √Ångel y teno chinco a√±os‚Ä¶ mis maestlas piensan que hablo as√≠, ¬°¬°que ponque estoy mimado!!‚Äù<br><br>
                <strong>Informaci√≥n familiar:</strong> Su padre nos dice que tiene una malformaci√≥n del frenillo lingual. √âste es demasiado corto. Lo que le dificulta pronunciar ciertos fonemas.
            `,
            luis: `
                <strong>Relato del alumno:</strong> ‚ÄúHooollaaa mii nooombreee eess Luuu√≠√≠sss yy vvooyy cccaaammiinnnoo aa ccaassa. Ooos nneeeccssiitto pppooorrrqqquuueee mmuucchhaaa ggeeennnttee ssee rr√≠√≠e ddee mii cccuannndooo hhhabblloo. Pporrr eessoo hhhayy vveeecess qqquuee dddeeecciiiddoo qquuuee mmejjooorr nnnoo hhaaccerlo.‚Äù<br><br>
                <strong>Informaci√≥n familiar:</strong> Su madre nos dice que Lu√≠s tiende a ser lento en el habla, su tono es bajo y mon√≥tono, y muestra debilidad y espasticidad en un lado del cuerpo, lengua y labios.
            `
        };

        const tasks = [
            { id: 1, title: "TAREA 1: Identificaci√≥n del trastorno", desc: "Identificar el posible trastorno y subtipo para el caso, haciendo referencia a evidencias del texto. Argumenta la respuesta." },
            { id: 2, title: "TAREA 2: Indicadores de riesgo", desc: "Elaborar una lista con los indicadores de riesgo M√ÅS CARACTER√çSTICOS seg√∫n el trastorno. Argumenta la respuesta (m√≠nimo 6)." },
            { id: 3, title: "TAREA 3: Propuesta de intervenci√≥n", desc: "Describir 2 actividades adecuadas para trabajar tempranamente los indicadores descritos. No es necesaria ficha completa. <br><strong>REQUISITO:</strong> Al menos una actividad debe ser inclusiva (para todo el grupo clase)." }
        ];

        const data = {
            degrees: [
                { 
                    id: '1', 
                    title: 'M√°ster Universitario en Formaci√≥n del Profesorado', 
                    subjects: [
                        {code:'01MSEC', name:'01MSEC_Aprendizaje y desarrollo de la personalidad'}, 
                        {code:'03MSEC', name:'03MSEC_Sociedad, familia y educaci√≥n'}
                    ] 
                },
                { 
                    id: '2', 
                    title: 'M√°ster Universitario en Metodolog√≠as Activas y Digitales', 
                    subjects: [
                        {code:'02MADI', name:'02MADI_Habilidades Docentes Avanzadas para el Aprendizaje'}
                    ] 
                },
                { 
                    id: '3', 
                    title: 'Grado Universitario en Educaci√≥n Infantil', 
                    subjects: [
                        {code:'43GEIN', name:'43GEIN_04_A_2026-27_Dificultades en el aprendizaje, trastornos de la comunicaci√≥n y TDA / hiperactividad'}, 
                        {code:'8GEIN', name:'8GEIN_04_A_2026-27_Estimulaci√≥n del lenguaje oral'}
                    ] 
                }
            ]
        };

        const app = {
            history: [], 

            show(id) {
                document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
                document.getElementById(id).classList.remove('hidden');
                const bc = document.getElementById('breadcrumbs');
                if (id === 'view-home') {
                    bc.classList.add('hidden');
                    this.history = [];
                } else {
                    bc.classList.remove('hidden');
                    this.updateBreadcrumbs();
                }
            },

            updateBreadcrumbs() {
                const bc = document.getElementById('breadcrumbs');
                let text = "Inicio";
                if (this.history.length > 0) text += " > " + this.history[this.history.length-1];
                bc.innerText = "< " + text;
            },

            goHome() { this.renderDegrees(); },

            renderDegrees() {
                this.history = [];
                const g = document.getElementById('degrees-grid');
                g.innerHTML = '';
                data.degrees.forEach(d => {
                    g.innerHTML += `
                        <div class="card">
                            <h3>${d.title}</h3>
                            <p>Accede a las asignaturas disponibles.</p>
                            <button class="btn" onclick="app.loadDegree('${d.id}')">Ver Asignaturas</button>
                        </div>`;
                });
                this.show('view-home');
            },

            loadDegree(id) {
                const d = data.degrees.find(x => x.id === id);
                this.history = [d.title]; 
                document.getElementById('degree-title').innerText = d.title;
                const g = document.getElementById('subjects-grid');
                g.innerHTML = '';
                d.subjects.forEach(s => {
                    // Se muestran los c√≥digos completos como t√≠tulos y los nombres completos debajo
                    g.innerHTML += `
                        <div class="card">
                            <h3>${s.code}</h3>
                            <p>${s.name}</p>
                            <button class="btn" onclick="app.loadSubject('${s.name}')">Acceder</button>
                        </div>`;
                });
                this.show('view-subjects');
            },

            loadSubject(fullName) {
                this.history.push("Asignatura");
                // Comprobaci√≥n exacta del nombre largo
                const especialSubject = '43GEIN_04_A_2026-27_Dificultades en el aprendizaje, trastornos de la comunicaci√≥n y TDA / hiperactividad';
                
                if (fullName === especialSubject) {
                    document.getElementById('unit-subject-title').innerText = fullName;
                    const g = document.getElementById('units-grid');
                    g.innerHTML = '';
                    g.innerHTML += `<div class="card"><h3>Unidad Competencial 2</h3><button class="btn" onclick="alert('Pr√≥ximamente')">Entrar</button></div>`;
                    g.innerHTML += `<div class="card"><h3>Unidad Competencial 3</h3><p>Acceso a Actividades y Simulaciones.</p><button class="btn" onclick="app.loadUC3Menu()">Entrar</button></div>`;
                    g.innerHTML += `<div class="card"><h3>Unidad Competencial 4</h3><button class="btn" onclick="alert('Pr√≥ximamente')">Entrar</button></div>`;
                    this.show('view-units');
                } else {
                    // Manejo para las otras asignaturas (que no est√°n vac√≠as)
                    document.getElementById('subject-title').innerText = fullName;
                    this.show('view-levels');
                }
            },

            loadUC3Menu() {
                this.history.push("UC3");
                this.show('view-uc3-menu');
            },

            loadUC3ActivityMenu() {
                this.history.push("Actividad");
                this.show('view-uc3-cases-menu');
            },

            loadCase(caseKey) {
                const names = {
                    marina: "Caso de Marina", anais: "Caso de Ana√≠s", raul: "Caso de Ra√∫l", angel: "Caso de √Ångel", luis: "Caso de Lu√≠s"
                };
                
                this.history.push(names[caseKey]);
                document.getElementById('case-title').innerText = names[caseKey];
                
                // Inyectar el contenido HTML del caso
                document.getElementById('case-content').innerHTML = `<div class="case-text">${casesData[caseKey]}</div>`;
                
                // Generar las tareas con sus chats espec√≠ficos
                const tasksContainer = document.getElementById('case-tasks-container');
                tasksContainer.innerHTML = '';
                
                tasks.forEach(task => {
                    const chatId = `chat-${caseKey}-${task.id}`;
                    tasksContainer.innerHTML += `
                        <div class="task-block">
                            <div class="task-title">${task.title}</div>
                            <p class="task-desc">${task.desc}</p>
                            <div class="chat-box">
                                <div class="chat-header">
                                    <span>üí¨ Tutor Virtual</span>
                                </div>
                                <div class="chat-messages" id="${chatId}">
                                    <div class="message msg-ai">Hola. Soy tu tutor virtual, ¬øqu√© planteamiento tienes para esta tarea?</div>
                                </div>
                                <div class="chat-input-area">
                                    <input type="text" class="chat-input" id="input-${chatId}" placeholder="Escribe tu respuesta..." onkeypress="if(event.key==='Enter') app.sendMessage('${caseKey}', ${task.id})">
                                    <button class="chat-btn" onclick="app.sendMessage('${caseKey}', ${task.id})">Enviar</button>
                                </div>
                            </div>
                        </div>
                    `;
                });

                this.show('view-uc3-case-detail');
            },

            sendMessage(caseKey, taskId) {
                const chatId = `chat-${caseKey}-${taskId}`;
                const inputId = `input-${chatId}`;
                const input = document.getElementById(inputId);
                const text = input.value.trim();
                
                if (!text) return;

                // 1. Mostrar mensaje usuario
                const msgContainer = document.getElementById(chatId);
                msgContainer.innerHTML += `<div class="message msg-user">${text}</div>`;
                input.value = '';
                msgContainer.scrollTop = msgContainer.scrollHeight;

                // 2. Simular "Escribiendo..."
                const loadingId = `loading-${Date.now()}`;
                msgContainer.innerHTML += `<div id="${loadingId}" class="message msg-ai" style="opacity:0.7">...</div>`;
                msgContainer.scrollTop = msgContainer.scrollHeight;

                // 3. Generar respuesta IA
                setTimeout(() => {
                    document.getElementById(loadingId).remove();
                    const aiResponse = this.generateAIResponse(caseKey, text);
                    msgContainer.innerHTML += `<div class="message msg-ai">${aiResponse}</div>`;
                    msgContainer.scrollTop = msgContainer.scrollHeight;
                }, 1000);
            },

            generateAIResponse(caseKey, text) {
                // Utiliza el "cerebro" configurado al inicio
                if (aiBrain[caseKey]) {
                    return aiBrain[caseKey].check(text);
                }
                return "Entiendo. Contin√∫a desarrollando tu idea bas√°ndote en los s√≠ntomas descritos.";
            },

            loadUC3PracticeLevels() {
                this.history.push("Pr√°ctica");
                this.show('view-uc3-levels');
            },

            loadUC3SimGrid(level) {
                this.history.push("Nivel " + level);
                document.getElementById('uc3-sim-title').innerText = "UC3 - Pr√°ctica - Nivel " + level;
                const g = document.getElementById('uc3-sim-grid');
                g.innerHTML = '';
                for(let i=1; i<=20; i++) {
                    g.innerHTML += `<div class="card-sim"><strong>Simulaci√≥n ${i}</strong></div>`;
                }
                g.innerHTML += `<div class="card-sim card-ia" onclick="alert('Generando nueva simulaci√≥n con IA...')"><strong>+ Acceso a m√°s simulaciones generadas por IA</strong></div>`;
                this.show('view-uc3-sims');
            },

            loadSimulations(n) {
                this.history.push("Nivel " + n);
                document.getElementById('level-title').innerText = "Simulaciones - Nivel " + n;
                const g = document.getElementById('simulations-grid');
                g.innerHTML = '';
                for(let i=1; i<=20; i++) {
                    g.innerHTML += `<div class="card-sim"><strong>Simulaci√≥n ${i}</strong></div>`;
                }
                this.show('view-simulations');
            }
        };

        app.renderDegrees();
    </script>
</body>
</html>
